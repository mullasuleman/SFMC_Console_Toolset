var tf=null,mtf=e=>{var t=new Blob([e],{type:"text/csv"});return null!==tf&&window.URL.revokeObjectURL(tf),tf=window.URL.createObjectURL(t)},df=(e,t)=>{var n=document.createElement("a");n.setAttribute("download",`${t}.csv`),n.href=mtf(e),n.click()},toCSV=e=>{ok=Object.keys(e[0]);return[Object.keys(e[0]),...e.map((e=>{let t=[];for(let n in ok)t.push(e[ok[n]].replaceAll(",",""));return t}))].map((e=>e.join(","))).join("\n")},getDEFieldList=()=>{if(document.querySelectorAll(".de-content-fields-listings").length<=0)return"No Data Extension Found............................... Change iframe context to Email ⇓";var e=[];return document.querySelectorAll(".de-listing-name-view").forEach((t=>e.push(t.innerText))),e.length>0&&df(e.join(),"Blank_"+document.querySelector("#op-head-name-static").value),"Downloading file..."},getDESchema=()=>{if(document.querySelectorAll(".de-content-fields-listings").length<=0)return"No Data Extension Found............................... Change console context to iframe 'Email' ⇓";var e=[],t=document.querySelector(".lg-head-breadcrumb").innerText.replaceAll("\n"," "),n=document.querySelector("#op-head-name-static").value,r=document.querySelector(".carb-input-popover.op-key-pop").value;e.push("Path: ,"+t+",,,,\n"),e.push("DE Name: ,"+n+",,,,\n"),e.push("External Key: ,"+r+",,,,\n"),e.push(",,,,,\n"),e.push("Field Name,Data Type,Length,Primary Key,Nullable,Default Value\n");var o=document.querySelectorAll(".de-content-fields-listing").length-1;return document.querySelectorAll(".de-content-fields-listing").forEach(((t,n)=>{n!=o&&e.push(t.querySelector(".de-listing-name-view").innerText+","+t.querySelector(".de-content-listing-txt span").innerText+","+t.querySelector(".de-listing-length-view").innerText+","+(t.querySelector(".de-content-listing-primary input").checked?"Yes":"")+","+(t.querySelector(".de-content-listing-nullable input").checked?"Yes":"No")+","+t.querySelector(".de-content-listing-dvalue-view").innerText+"\n")})),e.length>0&&df(e.join(""),"Schema_"+document.querySelector("#op-head-name-static").value),"Downloading file..."},getListsFromFolder=()=>{window.sfmcLists=window.sfmcLists||[];var e=1;console.log("Please wait...");var t=setInterval((()=>{console.log("Page "+e);var n=document.querySelectorAll(".grp-center.div-center .row").length,r=[];for(document.querySelectorAll(".grp-center.header-center [data-property]").forEach((e=>r.push(e.innerText))),i=2;i<=n-1;i++){var o=document.querySelector(".lg-head-breadcrumb.clearfix").innerText.replaceAll("\n"," ").trim()||"My Lists",l=document.querySelector(`.grp-center.div-center .row:nth-of-type(${i}) .cell:first-of-type`).innerText,c=document.querySelector(`.grp-center.div-center .row:nth-of-type(${i}) .cell:nth-of-type(${r.indexOf("Subscriber Count")+1})`).innerText,d=document.querySelector(`.grp-center.div-center .row:nth-of-type(${i}) .cell:nth-of-type(${r.indexOf("External Key")+1})`).innerText,a=document.querySelector(`.grp-center.div-center .row:nth-of-type(${i}) .cell:nth-of-type(${r.indexOf("List ID")+1})`).innerText;window.sfmcLists.push({folder:o,deName:l,externalKey:d,listID:a,recordCount:c})}var s=document.querySelector(".btn.grid-nextpage");if("disabled"==s.getAttribute("disabled"))return clearInterval(t),void console.table(window.sfmcLists);s.click(),e++}),5e3)},getDEsFromFolder=()=>{window.sfmcDEs=window.sfmcDEs||[];var e=1;console.log("Please wait...");var t=setInterval((()=>{console.log("Page "+e);var n=document.querySelectorAll(".grp-left.div-left .row").length-1,r=[];for(document.querySelectorAll(".grp-center.header-center [data-property]").forEach((e=>r.push(e.innerText))),i=2;i<=n;i++){var o=document.querySelector(".dg-head-breadcrumb.clearfix").innerText.replaceAll("\n"," ").trim()||"Data Extensions",l=document.querySelector(`.grp-left.div-left .row:nth-of-type(${i}) .cell:last-of-type`).innerText,c=document.querySelector(`.grp-center.div-center .row:nth-of-type(${i}) .cell:nth-of-type(${r.indexOf("Sendable")+1})`).innerText,d=document.querySelector(`.grp-center.div-center .row:nth-of-type(${i}) .cell:nth-of-type(${r.indexOf("Record Count")+1})`).innerText.replaceAll(",",""),a=document.querySelector(`.grp-center.div-center .row:nth-of-type(${i}) .cell:nth-of-type(${r.indexOf("Field Count")+1})`).innerText,s=document.querySelector(`.grp-center.div-center .row:nth-of-type(${i}) .cell:nth-of-type(${r.indexOf("External Key")+1})`).innerText;window.sfmcDEs.push({folder:o,deName:l,externalKey:s,sendable:c,fieldCount:a,recordCount:d})}var u=document.querySelector(".btn.grid-nextpage");if("disabled"==u.getAttribute("disabled"))return clearInterval(t),console.table(window.sfmcDEs),void(document.querySelector("#downloadDEs span").innerText=" ("+window.sfmcDEs.length+")");u.click(),e++}),1e3)},downloadDEs=e=>{if(window.sfmcDEs){var t=toCSV(window.sfmcDEs);return t.length>0&&df(t,"DEs_"+(new Date).toLocaleDateString()),"Downloading file..."}},downloadLists=e=>{if(window.sfmcLists){var t=toCSV(window.sfmcLists);return t.length>0&&df(t,"Lists_"+(new Date).toLocaleDateString()),"Downloading file..."}},DETools=[{id:"getDEsFromFolder",func:getDEsFromFolder,label:"Scrape DEs"},{id:"getListsFromFolder",func:getListsFromFolder,label:"Scrape Lists"},{id:"getDESchema",func:getDESchema,label:"Download DE Schema"},{id:"getDEFieldList",func:getDEFieldList,label:"Download Empty CSV with DE Fields"},{id:"downloadDEs",func:downloadDEs,label:"Download DE List"},{id:"downloadLists",func:downloadLists,label:"Download Lists"}];let div=document.createElement("div");div.id="sfmcToolSetSM",Object.assign(div.style,{position:"absolute","z-index":1e3,width:"50%",left:"35%",bottom:"9px",display:"flex","justify-content":"center"}),DETools.forEach((e=>{let t=document.createElement("button");t.id=e.id,t.onclick=e.func,t.innerText=e.label,Object.assign(t.style,{background:"#96c1f9","margin-right":"10px","margin-bottom":"10px",padding:"2px 10px","border-radius":"5px",border:"none"}),div.append(t)})),document.querySelector("#divContent").prepend(div),document.querySelector("#downloadDEs").append(document.createElement("span"));
